---
title: "CHARM: Creating Halos with Auto-Regressive Multi-stage networks"
collection: publications
date: 2024-09-17
venue: 'arXiv preprint'
citation: 'S. Pandey, C. Modi, B.D. Wandelt, D.J. Bartlett, A.E. Bayer, G.L. Bryan, M. Ho, G. Lavaux, T.L. Makinen and F. Villaescusa-Navarro (2024). &quot;CHARM: Creating Halos with Auto-Regressive Multi-stage networks.&quot; <i>arXiv:2409.09124</i>.'
---

[Download paper here](https://arxiv.org/abs/2409.09124)

## Abstract
To maximize the amount of information extracted from cosmological datasets, simulations that accurately represent these observations are necessary. However, traditional simulations that evolve particles under gravity by estimating particle-particle interactions (N-body simulations) are computationally expensive and prohibitive to scale to the large volumes and resolutions necessary for the upcoming datasets. Moreover, modeling the distribution of galaxies typically involves identifying virialized dark matter halos, which is also a time- and memory-consuming process for large N-body simulations, further exacerbating the computational cost. In this study, we introduce CHARM, a novel method for creating mock halo catalogs by matching the spatial, mass, and velocity statistics of halos directly from the large-scale distribution of the dark matter density field. We develop multi-stage neural spline flow-based networks to learn this mapping at redshift z=0.5 directly with computationally cheaper low-resolution particle mesh simulations instead of relying on the high-resolution N-body simulations. We show that the mock halo catalogs and painted galaxy catalogs have the same statistical properties as obtained from N-body simulations in both real space and redshift space. Finally, we use these mock catalogs for cosmological inference using redshift-space galaxy power spectrum, bispectrum, and wavelet-based statistics using simulation-based inference, performing the first inference with accelerated forward model simulations and finding unbiased cosmological constraints with well-calibrated posteriors. The code was developed as part of the Simons Collaboration on Learning the Universe and is publicly available at [this url](https://github.com/shivampcosmo/CHARM).

![charm_pipeline](/files/2024-09-17-charm.png)
*Visualization of the data products and network architecture used in this study. On the left side of the dotted line, we show the matter density and velocity fields from the PM simulation that serve as the input to the ResNet layers to extract features. These features are then used to predict the halo distribution and velocities in four parts: the total number of halos is modeled using a mixture density network, the heaviest halo mass is modeled using a stack of spline transformations, and lower halo masses as well as halo velocities are modeled using a stack of auto-regressive neural spline flows. On the right side, we display the target distribution of the halos from paired true $N$-body simulation. Additionally, we present histograms of the four quantities in both low and high-density voxels, illustrating their dependence on the dark matter distribution.*
